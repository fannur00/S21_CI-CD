# Basic CI/CD

<br>

## Part 1. Настройка **gitlab-runner**

### Подними виртуальную машину **Ubuntu Server 22.04 LTS.**

![](./img/1.png)

### Скачай и установи на виртуальную машину **gitlab-runner.**

![](./img/2.png)

### Запусти **gitlab-runner** и зарегистрируй его для использования в текущем проекте (DO6_CICD).

![](./img/3.png)

## Part 2. Сборка
 <br>

### Напиши этап для CI по сборке приложений из проекта **C2_SimpleBashUtils.**

В файле gitlab-ci.yml добавь этап запуска сборки через мейк файл из проекта C2.

Файлы, полученные после сборки (артефакты), сохрани в произвольную директорию со сроком хранения 30 дней.

![](./img/4.png)

Проверил пайплайн, что все прошло успешно 

![](./img/5.png)

## Part 3. Тест кодстайла
<br>

### Напиши этап для CI, который запускает скрипт кодстайла (clang-format).

Если кодстайл не прошел, то «зафейли» пайплайн.

В пайплайне отобрази вывод утилиты clang-format.

![](./img/6.png)

- Вывод когда clang-format **не прошел**

![](./img/7.png)
![](./img/8.png)

- Вывод когда clang-format **прошел** 

![](./img/9.png)


## Part 4. Интеграционные тесты

<br>

### Напиши этап для CI, который запускает твои интеграционные тесты из того же проекта.

Запусти этот этап автоматически только при условии, если сборка и тест кодстайла прошли успешно.

Если тесты не прошли, то «зафейли» пайплайн.

![](./img/10.png)

 - Вывод когда **не прошли** тесты , пайплайн показывает что, что то не так

![](./img/11.png)

 - Вывод когда  **прошли** тесты , пайплайн показывает что все хорошо 

![](./img/12.png)

## Part 5. Этап деплоя

Подними вторую виртуальную машину **Ubuntu Server 22.04 LTS.**

![](./img/13.png)

###  Напиши этап для CD, который «разворачивает» проект на другой виртуальной машине.

Запусти этот этап вручную при условии, что все предыдущие этапы прошли успешно.

C помочью команд ниже соединил 2 ВМ через ssh ключ 
```sh
sudo su gitlab-runner 

ssh-keygen -t rsa -b 2048

ssh-copy-id s23@10.100.0.11
```

Напиши bash-скрипт, который при помощи ssh и scp копирует файлы, полученные после сборки (артефакты), в директорию /usr/local/bin второй виртуальной машины.

![](./img/14.png)

В файле gitlab-ci.yml добавь этап запуска написанного скрипта.

![](./img/15.png)